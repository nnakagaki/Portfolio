<!DOCTYPE html>
<html>
<head>
  <title>Norris Nakagaki Portfolio</title>
  <%= stylesheet_link_tag    'application', media: 'all' %>
  <%= javascript_include_tag 'application' %>
  <%= csrf_meta_tags %>
  <link href='http://fonts.googleapis.com/css?family=Righteous' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Oswald&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
</head>

<script>
  Asteroids.Images                  = {};
  Asteroids.Images.menu             = new Image();
  Asteroids.Images.menu.src         = "<%= image_url('outer-space.jpg') %>";
  Asteroids.Images.gameMode2        = new Image();
  Asteroids.Images.gameMode2.src    = "<%= image_url('island-noplanet.jpg') %>";
  Asteroids.Images.hugeAsteroid     = new Image();
  Asteroids.Images.hugeAsteroid.src = "<%= image_url('isflaksplanetResized.png') %>";

  Asteroids.Music.gameAudio1 = new Audio("<%= audio_url('test.mp3') %>");
  Asteroids.Music.gameAudio2 = new Audio("<%= audio_url('the-island-madeon-remix.mp3') %>");
  Asteroids.Music.menuAudio  = new Audio("<%= audio_url('menu.mp3') %>");

  Asteroids.Music.menuAudio.addEventListener('ended', function() {
    this.currentTime = 0;
    this.play();
  }, false);

  if (Portfolio.utils.isSafari()) {
    Portfolio.ProjectsSection.videoUrls = {
      LLC       : "<%= video_url('LLC_demo.mp4') %>",
      princess  : "<%= video_url('princess_demo_test.mp4') %>",
      asteroids : "<%= video_url('asteroids_gameplay_editted2.mp4') %>",
      snake     : "<%= video_url('snake_gameplay_cropped.mp4') %>",
      trello    : "<%= video_url('trello_demo_cropped.mp4') %>",
      chess     : "<%= video_url('chess_demo.mp4') %>"
    };
  } else {
    Portfolio.ProjectsSection.videoUrls = {
      LLC       : "<%= video_url('LLC_demo.ogg') %>",
      princess  : "<%= video_url('princess_demo_test.ogg') %>",
      asteroids : "<%= video_url('asteroids_gameplay_editted2.ogg') %>",
      snake     : "<%= video_url('snake_gameplay_cropped.ogg') %>",
      trello    : "<%= video_url('trello_demo_cropped.ogg') %>",
      chess     : "<%= video_url('chess_demo.ogg') %>"
    };
  }
</script>

<body>
  <%= render :partial => 'shared/sidebar' %>
  <div class="shadow hidden"></div>
  <div class="window">
  	<main>
  		<%= render :partial => 'shared/intro_section' %>
  		<%= render :partial => 'shared/projects_section' %>
      <%= render :partial => 'shared/skills_section' %>
      <%= render :partial => 'shared/about_section' %>
  		<%= render :partial => 'shared/contact_me_section' %>
  	</main>
  </div>

  <div class="asteroids hidden">
  <%= render :partial => 'games/asteroids' %>
  </div>

  <div class="snake-game hidden">
  <%= render :partial => 'games/snakeGame' %>
  </div>

	<%= yield %>

</body>

<script>
  Portfolio.ProjectsSection.initialize();

  $(".shadow").on("click", function (event) {
    $("iframe").remove();
    $(".info-modal").remove();
    $(event.currentTarget).addClass("hidden");
    $(".window").removeClass("hide-overflow");
    $(".asteroids").addClass("hidden");
    Asteroids.Music.menuAudio.pause();
    Asteroids.Music.menuAudio.currentTime = 0;
    if (typeof window.ast !== "undefined") {
      window.ast.closeGame();
    }

    $(".snake-game").addClass("hidden");

    $(window).scrollTop(window.yCorrToReturnTo);
  });

  $(".side-bar li").on("click", function (event) {
    $('html, body').animate({
      scrollTop: $($("main ."+event.target.className).last()).offset().top
    }, 300);
  });

  $(".next-section-triangle").on("click", function (event) {
    $('html, body').animate({
      scrollTop: $("main .main-section."+$(event.currentTarget).data("next-section")).offset().top
    }, 300);
  });

  $("form.contact-me").on("submit", function (event) {
    event.preventDefault();

    var name    = $("form.contact-me input.name").val(),
        email   = $("form.contact-me input.email").val(),
        content = $("form.contact-me textarea").val();

    if (name === "") {
      $(".contact div.message").append("Name cannot be empty! ");
      setTimeout(function () {
        $("div.contact div.message").html("");
      }, 5000)
    }

    if (email === "") {
      $(".contact div.message").append("Email cannot be empty! ");
      setTimeout(function () {
        $(".contact div.message").html("");
      }, 5000)
    }

    if (content === "") {
      $(".contact div.message").append("Content cannot be empty! ");
      setTimeout(function () {
        $(".contact div.message").html("");
      }, 5000)
    }

    if ((name !== "") && (email !== "") && (content !== "")) {
      $.ajax({
        url: "/contact_me",
        type: "GET",
        data: {mail: {name: name, email: email, content: content}},
        success: function (res) {
          $("form.contact-me input.name").val("");
          $("form.contact-me input.email").val("");
          $("form.contact-me textarea").val("");
          $("div.contact div.message").html("Email sent!");
          setTimeout(function () {
            $("div.contact div.message").html("");
          }, 5000)
        }
      });
    }
  });
</script>

<script>
  function toggleFullScreen(el) {
    if (!document.fullscreenElement &&    // alternative standard method
        !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement ) {  // current working methods
      if (el.requestFullscreen) {
        el.requestFullscreen();
      } else if (el.msRequestFullscreen) {
        el.msRequestFullscreen();
      } else if (el.mozRequestFullScreen) {
        el.mozRequestFullScreen();
      } else if (el.webkitRequestFullscreen) {
        document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
      }
    } else {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
      } else if (document.mozCancelFullScreen) {
        document.mozCancelFullScreen();
      } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
      }
    }
  }

</script>

<script>
  $(".skills ul").css("width", Math.floor(($(".skills h1").width())/120) * 120);
  $(window).on("resize", function (event) {
    $(".skills ul").css("width", Math.floor(($(".skills h1").width())/120) * 120);
  });

  var scrollFunc = function(sectionStr) {
    var section = $("main ."+sectionStr).last();
    if (section.offset().top <= $(window).scrollTop()) {
      var sectionHeight = section.offset().top + section.outerHeight() - $(window).scrollTop();
    } else if (section.offset().top + section.outerHeight() > $(window).scrollTop() + window.innerHeight) {
      var sectionHeight = $(window).scrollTop() + window.innerHeight - section.offset().top;
    } else {
      var sectionHeight = section.outerHeight();
    }
    var sectionColor = Math.floor(255 * (1 - sectionHeight/section.outerHeight()));
    $(".side-bar ul li."+sectionStr).css("color", "rgb("+sectionColor+",255,"+sectionColor+")");
  };

  var scrollAllFunc = function () {
    scrollFunc("intro");
    scrollFunc("projects");
    scrollFunc("skills");
    scrollFunc("about");
    scrollFunc("contact");
  };

  scrollAllFunc();

  $(window).on("scroll", function(event) {
    scrollAllFunc();
  });

  $("div.side-bar ul.links li a").on("mouseenter", function (event) {
    $(event.currentTarget).addClass("hover-animation");
    var intLength   = 2000,
        intLength2  = 500,
        timeoutFunc = function () {
          heartbeat = setTimeout(function () {
            intLength  = intLength * 0.9;
            intLength2 = intLength2 * 0.9;
            $(event.currentTarget).addClass("add-contrast");

            heartbeat2 = setTimeout(function () {
              $(event.currentTarget).removeClass("add-contrast");
            }, intLength2);

            timeoutFunc();
          }, intLength);
        };

    timeoutFunc();
  });

  $(".side-bar ul.links li a").on("mouseleave", function (event) {
    $(event.currentTarget).removeClass("hover-animation");
    $(event.currentTarget).removeClass("add-contrast");
    clearInterval(heartbeat);
    clearTimeout(heartbeat2);
  });

  $("main .skills ul li").on("click", function (event) {
    $('html, body').animate({
        scrollTop: $($("main div.skills").last()).offset().top + 100
    }, 300);

    $("main .skills ul li").removeClass("selected");
    $(event.currentTarget).addClass("selected");
    if ($("main .skills .info.active").length > 0) {
      $("main .skills .info").removeClass("active");
      setTimeout(function() {
        $("main .skills .info").addClass("active");
        $("main .skills .info").html("<h2>"+event.currentTarget.classList[0]+"</h2><img src="+$(event.currentTarget).find("img")[0].src+"><div class='clear'></div>")
      }, 500);
    } else {
      $("main .skills .info").addClass("active");
      $("main .skills .info").html("<h2>"+event.currentTarget.classList[0]+"</h2><img src="+$(event.currentTarget).find("img")[0].src+"><div class='clear'></div>")
    }
  });
</script>

</html>
