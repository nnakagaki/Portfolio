<!DOCTYPE html>
<html>
<head>
  <title>Norris Nakagaki Portfolio</title>
  <%= stylesheet_link_tag    'application', media: 'all' %>
  <%= javascript_include_tag 'application' %>
  <%= csrf_meta_tags %>
  <link href='http://fonts.googleapis.com/css?family=Righteous' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Oswald&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
</head>

<script>
  Asteroids.Images                  = {};
  Asteroids.Images.menu             = new Image();
  Asteroids.Images.menu.src         = "<%= image_url('outer-space.jpg') %>";
  Asteroids.Images.gameMode2        = new Image();
  Asteroids.Images.gameMode2.src    = "<%= image_url('island-noplanet.jpg') %>";
  Asteroids.Images.hugeAsteroid     = new Image();
  Asteroids.Images.hugeAsteroid.src = "<%= image_url('isflaksplanetResized.png') %>";

  Asteroids.Music.gameAudio1 = new Audio("<%= audio_url('test.mp3') %>");
  Asteroids.Music.gameAudio2 = new Audio("<%= audio_url('the-island-madeon-remix.mp3') %>");
  Asteroids.Music.menuAudio  = new Audio("<%= audio_url('menu.mp3') %>");

  Asteroids.Music.menuAudio.addEventListener('ended', function() {
    this.currentTime = 0;
    this.play();
  }, false);

  var isSafari = false;

  if (navigator.userAgent.indexOf('Safari') != -1 && navigator.userAgent.indexOf('Chrome') == -1) {
    isSafari = true;
  }

</script>

<body>
  <%= render :partial => 'shared/sidebar' %>
  <div class="shadow hidden"></div>
  <div class="window">
  	<main>
  		<%= render :partial => 'shared/intro_section' %>
  		<%= render :partial => 'shared/projects_section' %>
      <%= render :partial => 'shared/skills_section' %>
      <%= render :partial => 'shared/about_section' %>
  		<%= render :partial => 'shared/contact_me_section' %>
  	</main>
  </div>

  <div class="asteroids hidden">
  <%= render :partial => 'games/asteroids' %>
  </div>

  <div class="snake-game hidden">
  <%= render :partial => 'games/snakeGame' %>
  </div>

	<%= yield %>

</body>

<script>
  $("video").on("mouseenter", function (event) {
    if (event.currentTarget.readyState === 4) {
      event.currentTarget.play();
    }
  });

  $("video").on("mouseleave", function (event) {
    if (event.currentTarget.readyState === 4) {
      event.currentTarget.pause();
      event.currentTarget.currentTime = 0;
    }
  });

  var modalSetup = function () {
    $("div.info-modal video").on("mouseenter", function (event) {
      if (event.currentTarget.readyState === 4) {
        event.currentTarget.play();
      }
    });

    $("div.info-modal video").on("mouseleave", function (event) {
      if (event.currentTarget.readyState === 4) {
        event.currentTarget.pause();
        event.currentTarget.currentTime = 0;
      }
    });

    setTimeout(function () {
      $("div.info-modal").removeClass("init")
      $("div.info-modal").addClass("mid")

      setTimeout(function () {
        $("div.info-modal").removeClass("mid")
        $("div.info-modal").addClass("final")
      }, 500)
    }, 100);

    $("div.shadow").removeClass("hidden");
    window.yCorrToReturnTo = $(window).scrollTop();
    $("div.window").addClass("hide-overflow");
  };

  var videoUrls = {
    LLC       : "<%= video_url('LLC_demo.ogg') %>",
    princess  : "<%= video_url('princess_demo_test.ogg') %>",
    asteroids : "<%= video_url('asteroids_gameplay_editted2.ogg') %>",
    snake     : "<%= video_url('snake_gameplay_cropped.ogg') %>",
    trello    : "<%= video_url('trello_demo_cropped.ogg') %>",
    chess     : "<%= video_url('chess_demo.ogg') %>"
  }

  $("div.projects li.LLC").on("click", function (event) {
    $("body").append(JST.LLC({
      video_url : videoUrls.LLC
    }));

    $("div.info-modal div.iframe").on("click", function (event) {
      $("body").append("<iframe class='LLC' src='https://life-long-connections.herokuapp.com'></iframe>");
    });

    modalSetup();
  });

  $("div.projects li.princess").on("click", function (event) {
    if (event.target !== $("div.projects li.princess button.collaborators")[0]) {
      $("body").append(JST.princess({
        video_url : videoUrls.princess
      }));

      $("div.info-modal div.iframe").on("click", function (event) {
        $("body").append("<iframe class='princess' src='https://princess-diary.herokuapp.com'></iframe>");
      });

      modalSetup();
    }
  });

  $("div.projects li.asteroids div.front").on("click", function (event) {
    if (event.target !== $("div.projects li.asteroids button.collaborators")[0]) {
      $("body").append(JST.asteroids({
        video_url : videoUrls.asteroids
      }));

      $("div.info-modal div.iframe").on("click", function (event) {
        $("div.asteroids").removeClass("hidden");
        $("div.info-modal").addClass("hidden");
        Asteroids.Music.menuAudio.volume = 1;
        Asteroids.Music.menuAudio.currentTime = 0;
        Asteroids.Music.menuAudio.play();

        $(window).on("keyup", function (event) {
          if (event.keyCode === 13) {
            toggleFullScreen($("div.asteroids")[0]);
          }
        })
      });

      modalSetup();
    }
  });

  $("div.projects li.snake-game div.front").on("click", function (event) {
    if (event.target !== $("div.projects li.snake-game button.collaborators")[0]) {
      $("body").append(JST.snake({
        video_url : videoUrls.snake
      }));

      $("div.info-modal div.iframe").on("click", function (event) {
        $("div.snake-game").removeClass("hidden");
        $("div.info-modal").addClass("hidden");
      });

      modalSetup();
    }
  });

  $("div.projects li.trello").on("click", function (event) {
    $("body").append(JST.trello({
      video_url : videoUrls.trello
    }));

    $("div.info-modal div.iframe").on("click", function (event) {
      $("body").append("<iframe class='trello' src='https://norris-trello-clone.herokuapp.com'></iframe>");
    })

    modalSetup();
  });

  $("div.projects li.chess").on("click", function (event) {
    if (event.target !== $("div.projects li.chess button.collaborators")[0]) {
      $("body").append(JST.chess({
        video_url : videoUrls.chess
      }));

      $("div.info-modal div.iframe").on("click", function (event) {
        $("body").append("<iframe class='trello' src='https://norris-trello-clone.herokuapp.com'></iframe>");
      })

      modalSetup();
    }
  });

  $("div.shadow").on("click", function (event) {
    $("iframe").remove();
    $("div.info-modal").remove();
    $(event.currentTarget).addClass("hidden");
    $("div.window").removeClass("hide-overflow");
    $("div.asteroids").addClass("hidden");
    Asteroids.Music.menuAudio.pause();
    Asteroids.Music.menuAudio.currentTime = 0;
    if (typeof window.ast !== "undefined") {
      window.ast.closeGame();
    }

    $("div.snake-game").addClass("hidden");

    $(window).scrollTop(window.yCorrToReturnTo);
  });

  $("div.side-bar li").on("click", function (event) {
    $('html, body').animate({
      scrollTop: $($("main ."+event.target.className).last()).offset().top
    }, 300);
  });

  $(".next-section-triangle").on("click", function (event) {
    $('html, body').animate({
      scrollTop: $("main .main-section."+$(event.currentTarget).data("next-section")).offset().top
    }, 300);
  });

  $("form.contact-me").on("submit", function (event) {
    event.preventDefault();

    var name = $("form.contact-me input.name").val();
    var email = $("form.contact-me input.email").val();
    var content = $("form.contact-me textarea").val();

    if (name === "") {
      $("div.contact div.message").append("Name cannot be empty! ");
      setTimeout(function () {
        $("div.contact div.message").html("");
      }, 5000)
    }

    if (email === "") {
      $("div.contact div.message").append("Email cannot be empty! ");
      setTimeout(function () {
        $("div.contact div.message").html("");
      }, 5000)
    }

    if (content === "") {
      $("div.contact div.message").append("Content cannot be empty! ");
      setTimeout(function () {
        $("div.contact div.message").html("");
      }, 5000)
    }

    if ((name !== "") && (email !== "") && (content !== "")) {
      $.ajax({
        url: "/contact_me",
        type: "GET",
        data: {mail: {name: name, email: email, content: content}},
        success: function (res) {
          $("form.contact-me input.name").val("");
          $("form.contact-me input.email").val("");
          $("form.contact-me textarea").val("");
          $("div.contact div.message").html("Email sent!");
          setTimeout(function () {
            $("div.contact div.message").html("");
          }, 5000)
        }
      });
    }
  });

  var collab = function () {
    $("div.projects li button.collaborators").one("click", function (event) {
      var projectName = event.target.parentElement.parentElement.className;
      $("div.projects li."+projectName).addClass("flip");
      setTimeout(function () {
        $("div.projects li."+projectName).removeClass("flip");
        collab();
      }, 1500);
    });
  }

  collab();
</script>

<script>
  $("div.projects ul li").css("height", 51+$("div.projects ul li").width()*750/1250);
  $("div.projects ul li div.back img").css("height", $("div.projects ul li").width()*750/1250);
  $(window).on("resize", function (event) {
    $("div.projects ul li").css("height", 51+$("div.projects ul li").width()*750/1250);
    $("div.projects ul li div.back img").css("height", $("div.projects ul li").width()*750/1250);
  })

  function toggleFullScreen(el) {
    if (!document.fullscreenElement &&    // alternative standard method
        !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement ) {  // current working methods
      if (el.requestFullscreen) {
        el.requestFullscreen();
      } else if (el.msRequestFullscreen) {
        el.msRequestFullscreen();
      } else if (el.mozRequestFullScreen) {
        el.mozRequestFullScreen();
      } else if (el.webkitRequestFullscreen) {
        document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
      }
    } else {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
      } else if (document.mozCancelFullScreen) {
        document.mozCancelFullScreen();
      } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
      }
    }
  }

</script>

<script>
  $("div.skills ul").css("width", Math.floor(($("div.skills h1").width())/120) * 120);
  $(window).on("resize", function (event) {
    $("div.skills ul").css("width", Math.floor(($("div.skills h1").width())/120) * 120);
  });

  var scrollFunc = function(sectionStr) {
    var section = $("main ."+sectionStr).last();
    if (section.offset().top <= $(window).scrollTop()) {
      var sectionHeight = section.offset().top + section.outerHeight() - $(window).scrollTop();
    } else if (section.offset().top + section.outerHeight() > $(window).scrollTop() + window.innerHeight) {
      var sectionHeight = $(window).scrollTop() + window.innerHeight - section.offset().top;
    } else {
      var sectionHeight = section.outerHeight();
    }
    var sectionColor = Math.floor(255 * (1 - sectionHeight/section.outerHeight()));
    $("div.side-bar ul li."+sectionStr).css("color", "rgb("+sectionColor+",255,"+sectionColor+")");
  };

  var scrollAllFunc = function () {
    scrollFunc("intro");
    scrollFunc("projects");
    scrollFunc("skills");
    scrollFunc("about");
    scrollFunc("contact");
  };

  scrollAllFunc();

  $(window).on("scroll", function(event) {
    scrollAllFunc();
  });

  if (isSafari) {
    $("main div.projects ul li.LLC video")[0].src = "<%= video_url('LLC_demo.mp4') %>";
    $("main div.projects ul li.asteroids video")[0].src = "<%= video_url('asteroids_gameplay_editted2.mp4') %>";
    $("main div.projects ul li.princess video")[0].src = "<%= video_url('princess_demo_test.mp4') %>";
    $("main div.projects ul li.snake-game video")[0].src = "<%= video_url('snake_gameplay_cropped.mp4') %>";
    $("main div.projects ul li.trello video")[0].src = "<%= video_url('trello_demo_cropped.mp4') %>";
    $("main div.projects ul li.chess video")[0].src = "<%= video_url('chess_demo.mp4') %>";
  }

  $("div.side-bar ul.links li a").on("mouseenter", function (event) {
    $(event.currentTarget).addClass("hover-animation");
    var intLength = 2000
    var intLength2 = 500
    var timeoutFunc = function () {
      heartbeat = setTimeout(function () {
        intLength = intLength * 0.9;
        intLength2 = intLength2 * 0.9;
        $(event.currentTarget).addClass("add-contrast");
        heartbeat2 = setTimeout(function () {
          $(event.currentTarget).removeClass("add-contrast");
        }, intLength2)
        timeoutFunc()
      }, intLength)
    }

    timeoutFunc()
  });

  $("div.side-bar ul.links li a").on("mouseleave", function (event) {
    $(event.currentTarget).removeClass("hover-animation");
    $(event.currentTarget).removeClass("add-contrast");
    clearInterval(heartbeat);
    clearTimeout(heartbeat2);
  });

  $("main div.skills ul li").on("click", function (event) {
    $('html, body').animate({
        scrollTop: $($("main div.skills").last()).offset().top + 100
    }, 300);

    $("main div.skills ul li").removeClass("selected");
    $(event.currentTarget).addClass("selected");
    if ($("main div.skills div.info.active").length > 0) {
      $("main div.skills div.info").removeClass("active");
      setTimeout(function() {
        $("main div.skills div.info").addClass("active");
        $("main div.skills div.info").html("<h2>"+event.currentTarget.classList[0]+"</h2><img src="+$(event.currentTarget).find("img")[0].src+"><div class='clear'></div>")
      }, 500);
    } else {
      $("main div.skills div.info").addClass("active");
      $("main div.skills div.info").html("<h2>"+event.currentTarget.classList[0]+"</h2><img src="+$(event.currentTarget).find("img")[0].src+"><div class='clear'></div>")
    }
  });
</script>

</html>
